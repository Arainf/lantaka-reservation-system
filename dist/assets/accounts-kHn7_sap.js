import{j as e,r as o}from"./index-D5vEyPHo.js";import{c as ie,i as de}from"./lucide-D9gs9x5f.js";import{N as me,a as he}from"./NavigationTop-DyJ0_YrQ.js";import{S as X,B as Y,C as J,g as K,T as xe,h as ue,i as je,j as pe,m as fe}from"./NotificationBell-BTbLSTBQ.js";import{B as x}from"./createLucideIcon-8mYcU7v_.js";import{T as ge,a as Ne,b as Q,c as E,d as we,e as k}from"./table-D_aKbOch.js";import{D as Z,a as ee,b as ve,c as be,e as Ce}from"./dialog-C3s8z_XE.js";import{L as D}from"./label-_-sDx8Dq.js";import"./scroll-area-uXoW3jqd.js";import{T as se}from"./toaster-DeKnBLXS.js";import{e as ae,f as te,a as le,g as re}from"./App-Djhw_SJK.js";import{I as C}from"./input-2rwcTciZ.js";import{u as ne,o as ye,e as W,s as F,t as Se,d as De,F as _e,a as g,b as N,f as w,c as v,g as b,h as Ae}from"./form-DoCkAq2a.js";import{C as Te}from"./chevron-left-CITwkm69.js";import{C as Fe}from"./chevron-right-BAR7VKsc.js";import{X as ce}from"./index-BxHjqAeQ.js";import{D as Re}from"./deletemodal-vwdABMSc.js";import{S as O,a as I,b as $,c as M,d as y}from"./select-DQ9Ul_4x.js";import{L as Le}from"./loader-circle-BuNOI4_W.js";import{S as Pe}from"./search-B77jdn07.js";import{R as Ee}from"./refresh-cw-DRZkr8V2.js";import"./index-BhiIR7t5.js";import"./iconBase-Kpgs8Efe.js";import"./index-BGl0ELxP.js";import"./index-L6YSZLy6.js";import"./Combination-CrfrviD1.js";import"./toast-4AJFHnBj.js";import"./index-ByrSLeMy.js";function ke({isOpen:d,onClose:m,onConfirm:t,isLoading:u}){const{register:h,handleSubmit:l,formState:{errors:i}}=ne();return e.jsx(Z,{open:d,onOpenChange:m,className:"bg-transparent",children:e.jsxs(ee,{className:"sm:max-w-md",children:[e.jsx(ve,{children:e.jsx(be,{children:"Confirm Account Deletion"})}),e.jsxs("form",{onSubmit:l(t),className:"space-y-4 animate-none",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"password",children:"Enter your password to confirm deletion"}),e.jsx(C,{id:"password",type:"password",...h("password",{required:"Password is required"})}),i.password&&e.jsx("p",{className:"text-sm text-red-500",children:i.password.message})]}),e.jsxs(Ce,{className:"flex space-x-2 justify-end",children:[e.jsx(x,{type:"button",variant:"outline",onClick:m,children:"Cancel"}),e.jsx(x,{type:"submit",variant:"destructive",disabled:u,children:u?"Confirming...":"Confirm Delete"})]})]})]})})}function Oe({accounts:d,onDelete:m}){const[t,u]=o.useState(null),[h,l]=o.useState(!1),[i,a]=o.useState(!1),[p,_]=o.useState(!1),[r,R]=o.useState(1),f=5,j=Math.ceil(d.length/f),B=d.slice((r-1)*f,r*f),{toast:P}=ae(),{fetchAccountData:V}=te(),q=n=>{switch(n.toLowerCase()){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},z=n=>{u(n),l(!0)},H=()=>{a(!0),l(!1)},U=async n=>{if(!t)return;_(!0);const L=localStorage.getItem("userData"),c=JSON.parse(L);try{if((await le.post("http://localhost:5000/deletelogin",{email:c.email,username:c.username,password:n.password})).data.success)if((await fetch(`http://localhost:5000/api/deleteAccount/${t.account_id}`,{method:"DELETE"})).ok)m(t),l(!1),a(!1),P({title:"Success",description:"Account deleted successfully",variant:"success"});else throw new Error("Failed to delete account");else P({title:"Error",description:"Password verification failed",variant:"destructive"})}catch{P({title:"Success",description:"Account deleted successfully",variant:"success"})}finally{V(),_(!1),a(!1),l(!1)}},A=n=>{R(n)};return e.jsxs(e.Fragment,{children:[e.jsxs(ge,{children:[e.jsx(Ne,{children:e.jsxs(Q,{className:"hover:bg-bg-[#0f172a]",children:[e.jsx(E,{className:"w-[30%] text-white",children:"Account Name"}),e.jsx(E,{className:"w-[30%] text-white",children:"Role"}),e.jsx(E,{className:"w-[25%] text-white",children:"Username"}),e.jsx(E,{className:"w-[30%] text-white",children:"Status"})]})}),e.jsx(we,{children:B.map(n=>e.jsxs(Q,{onClick:()=>z(n),className:"cursor-pointer hover:bg-blue-100",children:[e.jsxs(k,{className:"flex items-center space-x-3 py-4",children:[e.jsx("img",{src:X,alt:"",width:32,height:32,className:"rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:`${n.account_fName} ${n.account_lName}`}),e.jsx("div",{className:"text-sm text-gray-500",children:n.account_email})]})]}),e.jsx(k,{children:n.account_role}),e.jsx(k,{children:n.account_username}),e.jsx(k,{children:e.jsx(Y,{variant:"secondary",className:q(n.account_status),children:n.account_status})})]},n.account_id))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(r-1)*f+1," to"," ",Math.min(r*f,d.length)," of"," ",d.length," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(x,{variant:"outline",onClick:()=>A(r-1),disabled:r===1,children:[e.jsx(Te,{className:"h-4 w-4"}),"Previous"]}),Array.from({length:j},(n,L)=>{const c=L+1;return c>2&&c<r-1||c<j-1&&c>r+1?e.jsx("span",{className:"text-muted-foreground",children:"..."},`ellipsis-${c}`):c===1||c===j||Math.abs(r-c)<=1?e.jsx(x,{variant:r===c?"default":"outline",size:"sm",onClick:()=>A(c),children:c},c):null}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>A(r+1),disabled:r===j,children:["Next",e.jsx(Fe,{className:"h-4 w-4"})]})]})]}),e.jsx(Z,{open:h,onOpenChange:l,children:e.jsxs(ee,{className:"bg-transparent p-0 max-w-4xl border-none flex flex-col items-center gap-3 shadow-none",showCloseButton:!1,children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 w-full max-w-lg",children:[e.jsxs("div",{className:"flex flex-row gap-3 items-center w-full",children:[e.jsx("img",{src:X,alt:"",width:60,height:60,className:"rounded-full"}),e.jsx(J,{className:"w-full",children:e.jsxs(K,{className:"py-3",children:[e.jsx("h3",{className:"font-semibold",children:t&&`${t.account_fName} ${t.account_lName}`}),e.jsx("p",{className:"text-sm text-gray-500",children:t&&t.account_email})]})}),e.jsx(x,{variant:"outline",onClick:()=>l(!1),children:e.jsx(ce,{className:"h-4 w-4 "})})]}),e.jsx(J,{className:"w-full",children:e.jsx(K,{className:"py-6",children:t&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{className:"font-semibold",children:"Role"}),e.jsx("p",{children:t.account_role})]}),e.jsxs("div",{children:[e.jsx(D,{className:"font-semibold",children:"Username"}),e.jsx("p",{children:t.account_username})]}),e.jsxs("div",{children:[e.jsx(D,{className:"font-semibold",children:"Phone"}),e.jsx("p",{children:t.account_phone})]}),e.jsxs("div",{children:[e.jsx(D,{className:"font-semibold",children:"Date of Birth"}),e.jsx("p",{children:t.account_dob})]}),e.jsxs("div",{children:[e.jsx(D,{className:"font-semibold",children:"Gender"}),e.jsx("p",{children:t.account_gender})]}),e.jsxs("div",{children:[e.jsx(D,{className:"font-semibold",children:"Last Login"}),e.jsx("p",{children:t.account_last_login})]})]})})})]}),e.jsx("div",{className:"flex justify-end gap-3 w-full max-w-lg",children:e.jsxs(x,{variant:"destructive",onClick:H,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Delete Account"]})})]})}),e.jsx(ke,{isOpen:i,onClose:()=>{a(!1),l(!0)},onConfirm:U,isLoading:p}),e.jsx(se,{})]})}const Ie=ye({account_role:W(["Administrator","Employee"],{required_error:"Please select a role."}),fName:F().min(1,"First name is required.").max(100,"First name must be 100 characters or less."),lName:F().min(1,"Last name is required.").max(100,"Last name must be 100 characters or less."),email:F().email("Invalid email address."),password:F().min(6,"Password must be at least 6 characters."),phone:F().min(10,"Phone number must be at least 10 digits.").max(15,"Phone number must be 15 digits or less."),dob:F().refine(d=>{const m=new Date(d);return m<new Date&&m>new Date("1900-01-01")},{message:"Please enter a valid date of birth."}),gender:W(["male","female"],{required_error:"Please select a gender."})});function $e(){const[d,m]=o.useState(!1),{renders:t,setRenderers:u}=re(),{toast:h}=ae(),l=ne({resolver:Se(Ie),defaultValues:{account_role:"Employee",gender:"male",fName:"",lName:"",email:"",password:"",phone:"",dob:""}});async function i(a){m(!0);try{const p=new FormData;Object.entries(a).forEach(([r,R])=>{p.append(r,String(R))}),(await le.post("http://localhost:5000/register",p,{headers:{"Content-Type":"multipart/form-data"}})).status===201&&(h({title:"Registration Successful",description:"New account has been created successfully.",variant:"success"}),l.reset()),u(r=>r+1)}catch(p){console.error("Registration error:",p),h({title:"Registration Failed",description:"There was an error creating the account. Please try again.",variant:"destructive"})}finally{m(!1)}}return e.jsxs(e.Fragment,{children:[e.jsxs(J,{className:"w-full max-w-2xl mx-auto",children:[e.jsxs(ue,{children:[e.jsx(je,{children:"Register New Account"}),e.jsx(pe,{children:"Create a new user account for the system."})]}),e.jsx(K,{children:e.jsx(De,{...l,children:e.jsx(_e,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(i),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(g,{control:l.control,name:"account_role",render:({field:a})=>e.jsxs(N,{children:[e.jsx(w,{children:"Role"}),e.jsxs(O,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(v,{children:e.jsx(I,{children:e.jsx($,{placeholder:"Select a role"})})}),e.jsxs(M,{children:[e.jsx(y,{value:"Administrator",children:"Administrator"}),e.jsx(y,{value:"Employee",children:"Employee"})]})]}),e.jsx(b,{})]})}),e.jsx(g,{control:l.control,name:"gender",render:({field:a})=>e.jsxs(N,{children:[e.jsx(w,{children:"Gender"}),e.jsxs(O,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(v,{children:e.jsx(I,{children:e.jsx($,{placeholder:"Select a gender"})})}),e.jsxs(M,{children:[e.jsx(y,{value:"male",children:"Male"}),e.jsx(y,{value:"female",children:"Female"})]})]}),e.jsx(b,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(g,{control:l.control,name:"fName",render:({field:a})=>e.jsxs(N,{children:[e.jsx(w,{children:"First Name"}),e.jsx(v,{children:e.jsx(C,{placeholder:"John",...a})}),e.jsx(b,{})]})}),e.jsx(g,{control:l.control,name:"lName",render:({field:a})=>e.jsxs(N,{children:[e.jsx(w,{children:"Last Name"}),e.jsx(v,{children:e.jsx(C,{placeholder:"Doe",...a})}),e.jsx(b,{})]})})]}),e.jsx(g,{control:l.control,name:"email",render:({field:a})=>e.jsxs(N,{children:[e.jsx(w,{children:"Email"}),e.jsx(v,{children:e.jsx(C,{type:"email",placeholder:"john.doe@example.com",...a})}),e.jsx(b,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(g,{control:l.control,name:"password",render:({field:a})=>e.jsxs(N,{children:[e.jsx(w,{children:"Password"}),e.jsx(v,{children:e.jsx(C,{type:"password",...a})}),e.jsx(Ae,{children:"Must be at least 6 characters long."}),e.jsx(b,{})]})}),e.jsx(g,{control:l.control,name:"phone",render:({field:a})=>e.jsxs(N,{children:[e.jsx(w,{children:"Phone Number"}),e.jsx(v,{children:e.jsx(C,{type:"tel",placeholder:"+1234567890",...a})}),e.jsx(b,{})]})})]}),e.jsx(g,{control:l.control,name:"dob",render:({field:a})=>e.jsxs(N,{children:[e.jsx(w,{children:"Date of Birth"}),e.jsx(v,{children:e.jsx(C,{type:"date",...a})}),e.jsx(b,{})]})}),e.jsx(x,{type:"submit",className:"w-full",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"mr-2 h-4 w-4 animate-spin"}),"Registering..."]}):"Register Account"})]})})})})]}),e.jsx(se,{})]})}function xs({sidebarOpen:d=!1,toggleSidebar:m=()=>{}}){const{accountData:t,fetchAccountData:u}=te(),[h,l]=o.useState(""),[i,a]=o.useState({role:"all",status:"all"}),[p,_]=o.useState(!1),[r,R]=o.useState(null),[f,j]=o.useState(!1),{renders:B,setRenderers:P}=re(),[V,q]=o.useState(0);o.useEffect(()=>{ie({icons:de})},[]);const z=o.useCallback(async()=>{await u(),q(s=>s+1)},[u]);o.useEffect(()=>{z(),j(!1)},[B]);const H=t?t.filter(s=>{const S=s.account_fName.toLowerCase().includes(h.toLowerCase())||s.account_lName.toLowerCase().includes(h.toLowerCase())||s.account_email.toLowerCase().includes(h.toLowerCase()),G=i.role==="all"||s.account_role===i.role,oe=i.status==="all"||s.account_status===i.status;return S&&G&&oe}):[],U=()=>{console.log(`Deleting account for ${r.account_fName} ${r.account_lName}`),_(!1),R(null)},A=(s,S)=>{a(G=>({...G,[s]:S}))},n=()=>{a({role:"all",status:"all"}),l("")},L=t?[...new Set(t.map(s=>s.account_role))]:[],c=t?[...new Set(t.map(s=>s.account_status))]:[],T=Object.entries(i).filter(([s,S])=>S!=="all");return e.jsxs("div",{className:"flex flex-row overflow-hidden relative w-screen h-screen bg-gray-100",children:[e.jsx(me,{isOpen:d}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx(he,{onSidebarToggle:m}),e.jsxs("main",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Accounts"}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(C,{type:"text",placeholder:"Search by name or email...",value:h,onChange:s=>l(s.target.value),className:"pl-10 pr-4 py-2 w-50 md:w-80"}),e.jsx("div",{className:"absolute inset-y-0 left-2 flex items-center pointer-events-none",children:e.jsx(Pe,{className:"text-gray-900",size:18})})]}),e.jsxs(O,{value:i.role,onValueChange:s=>A("role",s),children:[e.jsx(I,{className:"w-[180px]",children:e.jsx($,{placeholder:"Role"})}),e.jsxs(M,{children:[e.jsx(y,{value:"all",children:"All Roles"}),L.map(s=>e.jsx(y,{value:s,children:s},s))]})]}),e.jsxs(O,{value:i.status,onValueChange:s=>A("status",s),children:[e.jsx(I,{className:"w-[180px]",children:e.jsx($,{placeholder:"Status"})}),e.jsxs(M,{children:[e.jsx(y,{value:"all",children:"All Statuses"}),c.map(s=>e.jsx(y,{value:s,children:s},s))]})]}),e.jsxs(x,{variant:"outline",onClick:()=>j(!0),children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Add Account"]}),(T.length>0||h)&&e.jsx(x,{variant:"ghost",onClick:n,title:"Reset all filters",children:e.jsx(Ee,{className:"h-4 w-4"})})]})}),T.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:T.map(([s,S])=>e.jsx(Y,{variant:"secondary",children:S},s))}),e.jsx("div",{children:e.jsx(Oe,{accounts:H},V)})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>j(!1)}),e.jsx("div",{className:`fixed inset-y-0 right-0 w-[500px] bg-white shadow-lg transform ${f?"translate-x-0":"translate-x-full"} transition-transform duration-300 ease-in-out overflow-y-auto z-50`,children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx(x,{variant:"ghost",size:"md",onClick:()=>j(!1),className:"absolute top-1 right-[440px]",children:e.jsx(ce,{className:"h-6 w-6"})})}),e.jsx($e,{})]})})]}),e.jsx(Re,{isOpen:p,onClose:()=>_(!1),onConfirm:U,itemName:r?`${r.account_fName} ${r.account_lName}`:"",itemType:"Account"})]})}export{xs as default};
