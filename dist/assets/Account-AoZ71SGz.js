import{r as c,j as e,u as R}from"./index-D5vEyPHo.js";import{a as _,B as f}from"./createLucideIcon-8mYcU7v_.js";import{g as T,C as E,B as D,S as O,h as B,i as U}from"./NotificationBell-BTbLSTBQ.js";import{N as $,A as z}from"./clientNavigationTop-B6zx-apZ.js";import{L as b}from"./label-_-sDx8Dq.js";import{I as N}from"./input-2rwcTciZ.js";import{e as P,b as H,U as V}from"./App-Djhw_SJK.js";import"./toast-4AJFHnBj.js";import{S as I}from"./scroll-area-uXoW3jqd.js";import{L}from"./loader-circle-BuNOI4_W.js";import"./index-BxHjqAeQ.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=_("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=_("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=_("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=_("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),S=c.createContext();function G({children:o,defaultValue:l,className:m}){const[h,r]=c.useState(l);return e.jsx(S.Provider,{value:{activeTab:h,setActiveTab:r},children:e.jsx("div",{className:`${m} w-full`,children:o})})}function K({children:o,className:l}){return e.jsx("div",{className:`flex ${l}`,role:"tablist",children:o})}function A({value:o,children:l,className:m,activeClass:h="text-black",inactiveClass:r="text-gray-700"}){const{activeTab:u,setActiveTab:x}=c.useContext(S);return x?e.jsx("button",{onClick:()=>x(o),className:`px-4 py-2 rounded-t-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${m} ${u===o?h:r}`,role:"tab","aria-selected":u===o,children:l}):(console.error("TabsTrigger must be used within a Tabs component"),null)}function M({value:o,children:l,className:m}){const{activeTab:h}=c.useContext(S);return h!==o?null:e.jsx("div",{className:`p-4 ${m}`,role:"tabpanel",tabIndex:0,children:l})}function Q({data:o=[]}){const[l,m]=c.useState("all"),[h,r]=c.useState(null),[u,x]=c.useState(!1),[g,v]=c.useState("newest");P();const y=c.useMemo(()=>{let t=o;l!=="all"&&(t=o.filter(n=>l==="internal"?n.guest_type==="internal":l==="external"?n.guest_type==="external":!0));const a=t.reduce((n,s)=>{const i=`${s.timestamp}-${s.userData}`;return n[i]||(n[i]={timestamp:s.timestamp,guestId:s.guest_id,guestName:s.guest_name,guestEmail:s.guest_email,guestType:s.guest_type,receiptDate:s.receipt_date,receiptTotal:s.receipt_total_amount,receiptSubTotal:s.receipt_initial_total,additionalNotes:s.additional_notes,receiptDiscounts:[],reservationCheckin:s.reservation_checkin,reservationCheckout:s.reservation_checkout,reservations:[],reservationType:s.reservation_type,reservationRoomID:[],reservationVenueID:[]}),s.receipt_discounts.forEach(j=>{j&&!n[i].receiptDiscounts.some(F=>F.discount_id===j.discount_id)&&n[i].receiptDiscounts.push(j)}),s.reservation_type==="room"?n[i].reservationRoomID.push(s.reservation_id):s.reservation_type==="venue"&&n[i].reservationVenueID.push(s.reservation_id),n[i].reservations.push(s),n},{});return Object.values(a).sort((n,s)=>{const i=new Date(n.receiptDate),j=new Date(s.receiptDate);return g==="newest"?j-i:i-j})},[o,l,g]);function d(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}const w=t=>{r(t),x(!0)},p=()=>{x(!1)},C=t=>t?new Date(t).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",k=({isOpen:t,reservation:a,onClose:n})=>t?e.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-center items-center",children:[e.jsx("button",{onClick:n,className:"absolute top-[115px] right-[360px] text-white text-lg font-bold bg-red-500",children:"X"}),e.jsx("div",{className:"bg-white p-2 rounded-lg absolute left-[360px] top-[115px]",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Reservation Details"})}),e.jsxs("div",{className:"p-6 rounded-lg flex gap-4 w-2/3 overflow-y-auto relative mx-auto justify-center ",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg flex-[2] min-w-[10%] max-w-[40%]",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{children:e.jsxs("div",{className:"flex items-center space-x-3 py-3",children:[e.jsx("img",{src:O,alt:"",width:32,height:32,className:"rounded-full"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[d(a.guestName)," -"," ",e.jsx(D,{children:d(a.guestType)})]}),e.jsx("div",{className:"text-sm text-gray-500",children:a.guestEmail})]})]})}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("strong",{className:"font-semibold text-gray-700",children:"Receipt Total:"}),e.jsxs("span",{className:"text-lg font-medium text-gray-900",children:["₱",a.receiptTotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("strong",{className:"font-semibold text-gray-700",children:"Receipt Subtotal:"}),e.jsxs("span",{className:"text-lg font-medium text-gray-900",children:["₱",a.receiptSubTotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("strong",{className:"font-semibold text-gray-700",children:"Additional Notes:"}),e.jsx("span",{className:"text-gray-600",children:a.additionalNotes||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("strong",{className:"font-semibold text-gray-700",children:"Receipt Date:"}),e.jsx("span",{className:"text-gray-600",children:new Date(a.receiptDate).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("strong",{className:"font-semibold text-gray-700",children:"Check-In:"}),e.jsx("span",{className:"text-gray-600",children:C(a.reservationCheckin)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("strong",{className:"font-semibold text-gray-700",children:"Check-Out:"}),e.jsx("span",{className:"text-gray-600",children:C(a.reservationCheckout)})]})]})]})}),e.jsxs("div",{className:"bg-white p-4 rounded-lg flex-[1] min-w-[30%] max-w-[40%]",children:[e.jsxs("h4",{className:"font-semibold p-2 my-2",children:["Reservations (",a.reservations.length,"):"]}),e.jsx(I,{className:"h-[200px] w-full p-2 border rounded",children:a.reservations.map((s,i)=>e.jsx("div",{className:"mb-2 p-2 bg-gray-50 rounded",children:e.jsx("p",{className:"font-medium",children:s.reservation||`Reservation ${i+1}`})},i))})]})]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"p-1",children:[e.jsxs("div",{className:"mb-4 flex space-x-1",children:[e.jsx(f,{onClick:()=>m("all"),variant:l==="all"?"default":"outline",children:"All"}),e.jsx(f,{onClick:()=>m("internal"),variant:l==="internal"?"default":"outline",children:"Internal"}),e.jsx(f,{onClick:()=>m("external"),variant:l==="external"?"default":"outline",children:"External"}),e.jsxs(f,{onClick:()=>v(g==="newest"?"oldest":"newest"),variant:"outline",children:["Sort ",g==="newest"?"Oldest":"Newest"]})]}),e.jsx(I,{className:"h-[48vh]",children:e.jsx("div",{className:"space-y-4",children:y.map((t,a)=>e.jsx(E,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>w(t),children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-bold",children:[d(t.guestName)," -"," ",d(t.reservationType)]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(t.receiptDate).toLocaleDateString()})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:t.guestEmail}),e.jsx("div",{className:"mt-2",children:e.jsx(D,{variant:"secondary",children:t.guestType})})]})},a))})})]}),e.jsx(k,{isOpen:u,reservation:h,onClose:p})]})}function ce(){const{reservationsData:o}=H(),{userData:l,setUserData:m}=c.useContext(V),h=R(),[r,u]=c.useState({id:"",first_name:"",last_name:"",email:"",phone:"",dob:""}),[x,g]=c.useState(!1),[v,y]=c.useState(!1),[d,w]=c.useState(!1);c.useEffect(()=>{u(l)},[l]);const p=a=>{const{name:n,value:s}=a.target;u(i=>({...i,[n]:s}))},C=async()=>{const n={id:localStorage.getItem("account_id"),first_name:r.first_name,last_name:r.last_name,email:r.email,phone:r.phone,date_of_birth:r.dob};g(!0);try{const s=await fetch("http://localhost:5000/api/update_account",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("userToken")}`},body:JSON.stringify(n)});if(!s.ok)throw new Error("Failed to update account");const i=await s.json();console.log(i.message),m(i.account),w(!1)}catch(s){console.error(s)}finally{g(!1)}},k=()=>{y(!0),localStorage.removeItem("userToken"),setTimeout(()=>{y(!1),h("/auth/login")},1e3)},t=()=>{w(a=>!a)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50",children:e.jsx($,{})}),e.jsxs(E,{className:"fixed inset-0 w-screen h-screen pt-[5rem] bg-white/50 dark:bg-gray-900/50 overflow-hidden",children:[e.jsxs(B,{className:"pb-4 flex flex-col md:flex-row items-start md:items-center gap-6 md:gap-8",children:[e.jsx(z,{className:"w-24 h-24",children:e.jsx("img",{src:"src/assets/images/SchoolLogo.png",alt:"Upload Logo",className:"w-full h-full object-cover rounded-full"})}),e.jsx("div",{className:"flex-1",children:e.jsx(U,{className:"text-3xl font-bold",children:`${l.first_name} ${l.last_name}`.toUpperCase()})}),e.jsxs("div",{className:"flex gap-3 pt-[20px] md:self-start",children:[e.jsx(f,{onClick:C,disabled:x||!d,className:"bg-blue-500 text-white hover:bg-blue-600 shadow-lg hover:shadow-xl transition-all",children:x?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving Changes..."]}):"Save Changes"}),e.jsx(f,{onClick:k,disabled:v,className:"bg-[#FCB813] text-white hover:bg-yellow-600 shadow-lg hover:shadow-xl transition-all",children:v?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Logging Out..."]}):"Logout"}),e.jsx(f,{onClick:t,className:"bg-green-500 text-white hover:bg-green-600 shadow-lg hover:shadow-xl transition-all",children:d?"Cancel Edit":"Edit Account"})]})]}),e.jsx(T,{children:e.jsxs(G,{defaultValue:"personal",className:"mt-6",children:[e.jsxs(K,{className:"grid w-full grid-cols-2 gap-4 ",children:[e.jsxs(A,{value:"personal",className:"bg-blue-500 text-white hover:bg-blue-600 data-[state=active]:bg-blue-700 shadow-lg hover:shadow-xl transition-all flex items-center justify-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"User Info"]}),e.jsxs(A,{value:"bookings",className:"bg-blue-500 text-white hover:bg-blue-600 data-[state=active]:bg-blue-700 shadow-lg hover:shadow-xl transition-all flex items-center justify-center",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Booking History"]})]}),e.jsx(M,{value:"personal",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"first_name",className:"text-sm font-medium",children:"First Name"}),e.jsx(N,{type:"text",id:"first_name",name:"first_name",value:r.first_name,onChange:p,disabled:!d,className:"shadow-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"last_name",className:"text-sm font-medium",children:"Last Name"}),e.jsx(N,{type:"text",id:"last_name",name:"last_name",value:r.last_name,onChange:p,disabled:!d,className:"shadow-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"date_of_birth",className:"text-sm font-medium",children:"Date of Birth"}),e.jsx(N,{type:"date",id:"date_of_birth",name:"date_of_birth",value:r.dob,onChange:p,disabled:!d,className:"shadow-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"email",className:"text-sm font-medium flex items-center",children:["Email ",e.jsx(J,{className:"ml-2 w-4 h-4"})]}),e.jsx(N,{type:"email",id:"email",name:"email",value:r.email,onChange:p,disabled:!d,className:"shadow-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"phone",className:"text-sm font-medium flex items-center",children:["Phone ",e.jsx(X,{className:"ml-2 w-4 h-4"})]}),e.jsx(N,{type:"text",id:"phone",name:"phone",value:r.phone,onChange:p,disabled:!d,className:"shadow-sm"})]})]})}),e.jsx(M,{value:"bookings",children:e.jsx("div",{className:"pt-1",children:e.jsx(Q,{data:o})})})]})})]})]})}export{ce as default};
