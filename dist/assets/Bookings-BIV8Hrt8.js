import{r as l,j as e}from"./index-D5vEyPHo.js";import{b as H,p as U,i as q,a as g}from"./App-Djhw_SJK.js";import{B as u}from"./createLucideIcon-8mYcU7v_.js";import{D as J,a as K,b as Q,c as X,d as Y,e as Z}from"./dialog-C3s8z_XE.js";import{C as ee,h as se,i as te,g as ae,B as re}from"./NotificationBell-BTbLSTBQ.js";import{S as p,a as f,b as v,c as j,d as i}from"./select-DQ9Ul_4x.js";import{N as le}from"./clientNavigationTop-B6zx-apZ.js";import{R as ne}from"./ReservationsTable-DE6fJQYy.js";import{C as oe}from"./chevron-left-CITwkm69.js";import{C as ie}from"./chevron-right-BAR7VKsc.js";import{S as ce}from"./search-B77jdn07.js";import{R as de}from"./refresh-cw-DRZkr8V2.js";import"./Combination-CrfrviD1.js";import"./index-BxHjqAeQ.js";import"./index-ByrSLeMy.js";import"./loader-circle-BuNOI4_W.js";import"./scroll-area-uXoW3jqd.js";import"./separator-B0NTeVhd.js";import"./table-D_aKbOch.js";import"./label-_-sDx8Dq.js";import"./toaster-DeKnBLXS.js";import"./toast-4AJFHnBj.js";import"./save-DRGOTJxu.js";import"./circle-plus-Dc_8mQmt.js";function Ve(){const{reservationsData:T,fetchReservations:ue}=H(),[me,_]=l.useState([]),{bookingSummary:m}=U(),[xe,B]=l.useState(null),[y,O]=l.useState(!1),[o,w]=l.useState(null),[c,N]=l.useState(""),[n,C]=l.useState({guest_type:"all",status:"all"}),[r,S]=l.useState({key:null,direction:"ascending"}),{createNotification:F}=q(),[d,I]=l.useState(!1);l.useEffect(()=>{b(),$()},[]);const b=async()=>{try{const s=await g.get("http://localhost:5000/api/events");_(s.data)}catch(s){console.error("Error fetching events:",s)}},$=async()=>{try{const s=await g.get("http://localhost:5000/api/booking-summary");setBookingSummary(s.data)}catch(s){console.error("Error fetching booking summary:",s)}},x=()=>{O(!1),B(null),w(null)},L=async()=>{try{const s=[...o.rooms,...o.venues].map(a=>g.put(`http://localhost:5000/api/reservationCalendar/${a.reservation}`,{id:a.reservation,status:a.resource.status,type:a.resource.type}));await Promise.all(s),await b(),x();const t=localStorage.getItem("userData.first_name");F({type:"Modified",description:`Account Name: "${t}" has updated event id "${event.reservation}".`,role:"Administrator"})}catch(s){console.error("Error updating events:",s),alert("Failed to update reservation statuses. Please try again.")}},k={waiting:1,ready:2,onUse:3,onCleaning:4,done:5,cancelled:6},D=T.filter(s=>{const t=s.guest_name.toLowerCase().includes(c.toLowerCase())||s.account_name.toLowerCase().includes(c.toLowerCase()),a=n.guest_type==="all"||s.guest_type===n.guest_type,P=n.status==="all"||s.status===n.status;return t&&a&&P}).sort((s,t)=>k[s.status]-k[t.status]),V=l.useMemo(()=>{let s=[...D];return r.key!==null&&s.sort((t,a)=>t[r.key]<a[r.key]?r.direction==="ascending"?-1:1:t[r.key]>a[r.key]?r.direction==="ascending"?1:-1:0),s.sort((t,a)=>t.status==="Waiting"&&a.status!=="Waiting"?-1:t.status!=="Waiting"&&a.status==="Waiting"?1:0)},[D,r]),A=s=>{let t="ascending";r.key===s&&r.direction==="ascending"&&(t="descending"),S({key:s,direction:t})},M=s=>{console.log(`Deleting reservation for ${s.guest_name}`)},E=(s,t)=>{C(a=>({...a,[s]:t}))},W=()=>{C({guest_type:"all",status:"all"}),N(""),S({key:null,direction:"ascending"})},z=["internal","external"],R=["waiting","confirmed","cancelled","onUse","onCleaning","done"],h=Object.entries(n).filter(([s,t])=>t!=="all"),G=()=>{I(!d)};return e.jsxs("main",{className:"bg-background pt-[65px] px-4 flex flex-col h-screen w-screen",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 w-full",children:e.jsx(le,{})}),e.jsxs("div",{className:"flex flex-row h-full relative",children:[e.jsxs("div",{className:`fixed left-0 top-[65px] bottom-0 bg-white shadow-lg transition-transform duration-300 ease-in-out transform ${d?"translate-x-0":"-translate-x-full"}`,style:{width:"300px",zIndex:40},children:[e.jsx(u,{onClick:G,className:"absolute -right-10 bottom-0 transform -translate-y-1/2 bg-primary text-white p-2 rounded-r-md",children:d?e.jsx(oe,{}):e.jsx(ie,{})}),e.jsxs(ee,{className:"h-full",children:[e.jsx(se,{className:"text-center",children:e.jsx(te,{children:"Booking Summary"})}),e.jsx(ae,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.total}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.rooms}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Rooms"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.venues}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Venues"})]})]})})]})]}),e.jsxs("div",{className:`space-y-4 flex-grow transition-all duration-300 ${d?"ml-[300px]":""}`,children:[e.jsx("h1",{className:"text-2xl pt-[20px] font-bold",children:"Reservations Management"}),e.jsx("div",{className:"flex flex-col space-y-4 lg:space-y-0 lg:flex-row lg:items-center lg:justify-between mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search by name or account...",value:c,onChange:s=>N(s.target.value),className:"pl-10 pr-4 py-2 w-full border-2 border-gray-300 bg-transparent rounded-lg focus:outline-none focus:border-blue-500"}),e.jsx("div",{className:"absolute inset-y-0 left-2 flex items-center pointer-events-none",children:e.jsx(ce,{className:"text-gray-900",size:18})})]}),e.jsxs(p,{value:n.guest_type,onValueChange:s=>E("guest_type",s),children:[e.jsx(f,{className:"w-full",children:e.jsx(v,{placeholder:"Guest Type"})}),e.jsxs(j,{children:[e.jsx(i,{value:"all",children:"All Guest Types"}),z.map(s=>e.jsx(i,{value:s,children:s},s))]})]}),e.jsxs(p,{value:n.status,onValueChange:s=>E("status",s),children:[e.jsx(f,{className:"w-full",children:e.jsx(v,{placeholder:"Status"})}),e.jsxs(j,{children:[e.jsx(i,{value:"all",children:"All Statuses"}),R.map(s=>e.jsx(i,{value:s,children:s},s))]})]}),(h.length>0||c)&&e.jsx(u,{variant:"ghost",onClick:W,title:"Reset all filters",className:"text-xs w-[50px]",children:e.jsx(de,{className:"h-4 w-4"})})]})}),h.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:h.map(([s,t])=>e.jsx(re,{variant:"default",children:t},s))}),e.jsx("div",{className:"w-full overflow-x-auto rounded-lg border bg-card",children:e.jsx("div",{className:"min-w-screen lg:w-full",children:e.jsx(ne,{data:V,onDelete:M,onSort:A,sortConfig:r})})})]})]}),y&&e.jsx(J,{open:y,onOpenChange:x,children:e.jsxs(K,{className:"w-[90vw] max-w-lg",children:[e.jsxs(Q,{children:[e.jsx(X,{children:"Edit Reservation"}),e.jsx(Y,{children:"Modify the reservation details as needed and save changes."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Status"}),e.jsxs(p,{value:(o==null?void 0:o.status)||"",onValueChange:s=>w(t=>({...t,status:s})),children:[e.jsx(f,{className:"w-full",children:e.jsx(v,{placeholder:"Select status"})}),e.jsx(j,{children:R.map(s=>e.jsx(i,{value:s,children:s},s))})]})]})}),e.jsxs(Z,{children:[e.jsx(u,{variant:"secondary",onClick:x,children:"Cancel"}),e.jsx(u,{onClick:L,children:"Save Changes"})]})]})})]})}export{Ve as default};
