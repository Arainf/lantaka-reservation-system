import{r as o,j as e}from"./index-D5vEyPHo.js";import{S as pe,B as N,C as V,g as J,T as We}from"./NotificationBell-BTbLSTBQ.js";import{a as K,B as m}from"./createLucideIcon-8mYcU7v_.js";import{S as x}from"./scroll-area-uXoW3jqd.js";import{S as $,T as Xe}from"./separator-B0NTeVhd.js";import{T as Qe,a as Ye,b as xe,c as _,d as Ze,e as C}from"./table-D_aKbOch.js";import{D as q,a as G,b as fe,c as ve,d as es,e as ss}from"./dialog-C3s8z_XE.js";import{L as ge}from"./label-_-sDx8Dq.js";import{S as ts,a as as,b as rs,c as je,d as ye}from"./select-DQ9Ul_4x.js";import{r as ns,b as is,e as os,k as ls,g as cs}from"./App-Djhw_SJK.js";import{T as ds}from"./toaster-DeKnBLXS.js";import{C as us}from"./chevron-left-CITwkm69.js";import{C as hs}from"./chevron-right-BAR7VKsc.js";import{S as ms}from"./save-DRGOTJxu.js";import{X as be}from"./index-BxHjqAeQ.js";import{C as ps}from"./circle-plus-Dc_8mQmt.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=K("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=K("PhilippinePeso",[["path",{d:"M20 11H4",key:"6ut86h"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"M7 21V4a1 1 0 0 1 1-1h4a1 1 0 0 1 0 12H7",key:"1ana5r"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=K("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),gs=(k,U)=>{const W=new Date(k),w=new Date(U).getTime()-W.getTime(),t=Math.ceil(w/(1e3*3600*24));return Math.max(t,1)};function Us({data:k=[],keys:U,onDelete:W}){var ne,ie,oe,le,ce,de;const[X,w]=o.useState(!1),[t,D]=o.useState(null),[S,Q]=o.useState(null),[Ne,F]=o.useState(!1),[R,M]=o.useState(""),[we,Y]=o.useState({}),[De,Te]=o.useState({"Double Bed":0,"Triple Bed":0,"Matrimonial Bed":0}),{price:v,setClientType:B,fetchPrice:_e}=ns(),{setDeleteData:I,setSaveNote:Ce,fetchReservations:Z,setReservationsData:js,reservationsData:ys}=is(),{toast:d}=os(),[h,Se]=o.useState(1),[b,bs]=o.useState(5),[A,Fe]=o.useState(""),Ie=()=>ae(!0);o.useState("");const{additionalFees:Ns,addFee:H,deleteFee:ee,calculateTotalWithFees:g}=ls(),[P,z]=o.useState([]),[E,se]=o.useState(""),[O,te]=o.useState(""),[ke,ae]=o.useState(!1),{renders:Re,setRenderers:re}=cs(),[Ae,Pe]=o.useState(""),Ee=o.useCallback(async()=>{if(!E||!O){d({title:"Error",description:"Please enter both description and amount.",variant:"destructive"});return}if(!(t!=null&&t.receiptId)){d({title:"Error",description:"No receipt selected.",variant:"destructive"});return}try{const s={receiptID:t.receiptId,name:E,amount:parseFloat(O)},a=await H(s);if(z(r=>[...r,a]),se(""),te(""),t){const r=g(t.receiptSubTotal,[...P,a]);D(n=>({...n,receiptTotal:r}))}d({title:"Success",description:"Additional fee has been added successfully.",variant:"success"}),re(r=>r+1),I(r=>r+1),loadFees()}catch(s){console.error("Failed to add fee:",s),d({title:"Success",description:"Additional fee has been added successfully.",variant:"success"})}},[E,O,P,H,g]),Oe=o.useCallback(async s=>{try{const a={receiptID:t.receiptId,feeId:s};if(await ee(a),z(r=>r.filter(n=>n.additional_fee_id!==s)),t){const r=P.filter(l=>l.additional_fee_id!==s),n=g(t.receiptSubTotal,r);D(l=>({...l,receiptTotal:n}))}d({title:"Success",description:"Additional fee has been deleted successfully.",variant:"success"}),Me(),I(r=>r+1),re(r=>r+1)}catch(a){console.error("Error deleting fee:",a),d({title:"Error",description:"Failed to delete additional fee.",variant:"destructive"})}},[P,ee,g]);o.useEffect(()=>{(async()=>{if(t!=null&&t.receiptId)try{const a=await fetch("http://localhost:5000/api/getAddFees2");if(!a.ok)throw new Error("Failed to fetch fees");const r=await a.json();if(z(r),t){const n=g(t.receiptSubTotal,r);D(l=>({...l,receiptTotal:n}))}}catch(a){console.error("Error loading fees:",a),d({title:"Error",description:"Failed to load additional fees.",variant:"destructive"})}})()},[t==null?void 0:t.receiptId,g,H,Re]),o.useEffect(()=>{const s=localStorage.getItem("userRole");Fe(s)},[]),o.useEffect(()=>{t!=null&&t.guestType&&B&&(B(t.guestType),console.log(t.guestType),_e(t.guestType))},[]),o.useEffect(()=>{v&&Te({"Double Bed":v.double_price||0,"Triple Bed":v.triple_price||0,"Matrimonial Bed":v.matrimonial_price||0})},[v]);const f=o.useMemo(()=>{const s=k.reduce((c,i)=>{const u=i.timestamp;return c[u]||(c[u]={timestamp:i.timestamp,reservations:[],guestId:i.guest_id,guestName:i.guest_name,guestEmail:i.guest_email,guestType:i.guest_type,reservationType:i.reservation_type,receiptId:i.receipt_id,receiptDate:i.receipt_date,receiptTotal:i.receipt_total_amount,receiptSubTotal:i.receipt_initial_total,additionalNotes:i.additional_notes,receiptDiscounts:[],receiptAddFees:[],reservationRoomID:[],reservationVenueID:[]}),i.receipt_discounts.forEach(p=>{p&&!c[u].receiptDiscounts.some(T=>T.discount_id===p.discount_id)&&c[u].receiptDiscounts.push(p)}),i.receipt_additional_fees.forEach(p=>{p&&!c[u].receiptAddFees.some(T=>T.additional_fee_id===p.additional_fee_id)&&c[u].receiptAddFees.push(p)}),i.reservation_type==="room"?c[u].reservationRoomID.push(i.reservation_id):i.reservation_type==="venue"?c[u].reservationVenueID.push(i.reservation_id):i.reservation_type==="both"&&(i.room_type?c[u].reservationRoomID.push(i.reservation_id):c[u].reservationVenueID.push(i.reservation_id)),c[u].reservations.push(i),c},{}),a=Object.values(s),r=h*b,n=r-b,l=a.slice(n,r);return{allItems:a,currentItems:l,totalPages:Math.ceil(a.length/b)}},[k,h,b]);console.log("grouped data",f);const L=s=>{s>=1&&s<=b&&Se(s)},Ve=async()=>{try{const s=await fetch("http://localhost:5000/api/generate-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guest_id:t.guestId,reservation_ids:t.reservationType==="both"?[...t.reservationRoomID,...t.reservationVenueID]:t.reservationType==="room"?t.reservationRoomID:t.reservationVenueID,type:t.reservationType,adddiscounts:t.receiptDiscounts,addFees:t.receiptAddFees,basePrice:t.receiptSubTotal})});if(!s.ok)throw new Error("Failed to generate PDF");const a=await s.blob(),r=window.URL.createObjectURL(a),n=document.createElement("a");n.href=r;const l=new Date().toISOString().split("T")[0],c=`${t.firstName}_${t.lastName}_reservation_${l}.pdf`;n.setAttribute("download",c),document.body.appendChild(n),n.click(),n.remove(),d({title:"PDF Generated Successfully",description:`The PDF has been generated and downloaded as ${c}`,variant:"default"})}catch(s){console.error("Error generating PDF:",s),d({title:"PDF Generation Failed",description:"There was an error generating the PDF. Please try again.",variant:"destructive"})}};o.useEffect(()=>{if(Array.isArray(v.venue_Holder)){const s=v.venue_Holder.reduce((a,r)=>(a[r.venue_id]=r.venue_price_internal||r.venue_price_external,a),{});Y(s)}else Y({})},[v]);const $e=s=>({ready:"bg-green-50",waiting:"bg-yellow-50",onUse:"bg-blue-50",cancelled:"bg-red-50",done:"bg-purple-50",onCleaning:"bg-orange-50"})[s]||"bg-gray-50",j=s=>({ready:"bg-green-200 text-green-800",waiting:"bg-yellow-200 text-yellow-800",onUse:"bg-blue-200 text-blue-800",cancelled:"bg-red-200 text-red-800",done:"bg-purple-200 text-purple-800",onCleaning:"bg-orange-200 text-orange-800"})[s]||"bg-gray-100 text-gray-800",y=s=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(s),Ue=s=>{Z(),D(s),M(s.additionalNotes||""),w(!0),Pe(s.receiptTotal),console.log("cellClick",s)},Me=()=>{console.log("refreshing"),Z()},Be=s=>{A==="Administrator"&&(Q(s),F(!0))},He=async s=>{if(S)try{const a={guest_id:S.guestId,type:s};if(s==="room")a.reservation_ids=t.reservationRoomID;else if(s==="venue")a.reservation_ids=t.reservationVenueID;else if(s==="both")a.reservation_ids=[...t.reservationRoomID,...t.reservationVenueID];else throw new Error("Invalid reservation type.");const r=await fetch("http://localhost:5000/api/delete_reservations",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw new Error("Failed to delete");const n=await r.json();console.log(n.message),d({title:"Deletion Successful",description:"Reservations have been deleted.",variant:"success"}),F(!1),w(!1),I(!0)}catch(a){console.error("Error deleting guest:",a),d({title:"Deletion Failed",description:"There was an error deleting the reservation data. Please try again.",variant:"destructive"})}finally{F(!1),Q(null)}},ze=()=>{w(!1)},Le=s=>{var a;t&&((a=t.reservations[0])==null?void 0:a.status)!=="done"&&D(r=>({...r,reservations:r.reservations.map(n=>({...n,status:s}))}))},Je=s=>{M(s.target.value),Ce(!1)},qe=async()=>{if(t)try{const s=await fetch("http://localhost:5000/api/update_notes",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({guest_id:t.guestId,notes:R,reservation_ids:t.reservationType==="both"?[...t.reservationRoomID,...t.reservationVenueID]:t.reservationType==="room"?t.reservationRoomID:t.reservationVenueID,type:t.reservationType})});if(!s.ok)throw new Error("Failed to update notes");const a=await s.json();console.log(a.message),D(l=>({...l,additionalNotes:R}));const r={...f},n=Object.keys(r).find(l=>r[l].guestId===t.guestId);n&&(r[n].additionalNotes=R),M(r.additionalNotes),d({title:"Notes Updated",description:`Additional notes for ${t.reservationType} have been updated successfully.`,variant:"success"}),I(l=>l+1)}catch(s){console.error("Error updating notes:",s),d({title:"Update Failed",description:`Failed to update the additional notes for ${t.reservationType}. Please try again.`,variant:"destructive"})}},Ge=async s=>{if(t)try{const a=t.reservations[0];if(!a)throw new Error("No reservation found for the selected guest.");const r=a.status;let n={guest_id:t.guestId,status:r,type:s};if(s==="room")n.reservation_room_ids=t.reservationRoomID;else if(s==="venue")n.reservation_venue_ids=t.reservationVenueID;else if(s==="both")n.reservation_room_ids=t.reservationRoomID,n.reservation_venue_ids=t.reservationVenueID;else throw new Error("Invalid reservation type.");console.log("Sending status update:",n);const l=await fetch("http://localhost:5000/api/change_status",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!l.ok)throw new Error("Failed to update reservation status.");const c=await l.json();console.log(c.message),d({title:"Status Updated",description:"Reservation status has been updated successfully.",variant:"success"}),I(i=>i+1)}catch(a){console.error("Error updating status:",a),d({title:"Update Failed",description:"Failed to update the reservation status. Please try again.",variant:"destructive"})}},Ke=(s,a)=>{switch(s.toLowerCase()){case"room":return e.jsx(N,{variant:"secondary",className:`${j(a||"default")}`,children:"Room"});case"venue":return e.jsx(N,{variant:"secondary",className:`${j(a||"default")}`,children:"Venue"});case"both":return e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(N,{variant:"secondary",className:`${j(a||"default")}`,children:"Room"}),e.jsx(N,{variant:"secondary",className:`${j(a||"default")}`,children:"Venue"})]});default:return e.jsx(N,{variant:"secondary",className:`${j(a||"default")}`,children:s})}};return e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{children:[e.jsx(Ye,{children:e.jsxs(xe,{className:"hover:bg-bg-[#0f172a]",children:[e.jsx(_,{className:"w-[25%] text-white",children:"Guest Details"}),e.jsx(_,{className:"w-[15%] text-white",children:"Guest Type"}),e.jsx(_,{className:"w-[15%] text-white",children:"Reservation Type"}),e.jsx(_,{className:"w-[20%] text-white",children:"Check-in"}),e.jsx(_,{className:"w-[15%] text-white",children:"Total Amount"}),e.jsx(_,{className:"w-[10%] text-white",children:"Status"})]})}),e.jsx(Ze,{children:f.currentItems.map((s,a)=>{var r,n,l,c,i,u,p,T,ue,he,me;return e.jsxs(xe,{className:`cursor-pointer ${$e(((r=s.reservations[0])==null?void 0:r.status)||"default")}`,onClick:()=>{Ue(s),B(s.guestType)},children:[e.jsxs(C,{className:"flex items-center space-x-3 py-4",children:[e.jsx("img",{src:pe,alt:U,width:32,height:32,className:"rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${((n=s.reservations[0])==null?void 0:n.status)==="done"?"line-through":""}`,children:s.guestName}),e.jsx("div",{className:`text-sm text-gray-500 ${((l=s.reservations[0])==null?void 0:l.status)==="done"?"line-through":""}`,children:s.guestEmail})]})]}),e.jsx(C,{children:e.jsx(N,{variant:"secondary",className:`${j(((c=s.reservations[0])==null?void 0:c.status)||"default")} text-${((i=s.reservations[0])==null?void 0:i.status)||"gray"}-600`,children:s.guestType})}),e.jsx(C,{children:Ke(s.reservationType,((u=s.reservations[0])==null?void 0:u.status)||"default")}),e.jsx(C,{className:((p=s.reservations[0])==null?void 0:p.status)==="done"?"line-through":"",children:new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0}).format(new Date(s.reservations[0].check_in_date))}),e.jsx(C,{className:((T=s.reservations[0])==null?void 0:T.status)==="done"?"line-through":"",children:y(s.receiptTotal)}),e.jsx(C,{children:e.jsx(N,{variant:"secondary",className:`${j(((ue=s.reservations[0])==null?void 0:ue.status)||"default")} text-${((he=s.reservations[0])==null?void 0:he.status)||"gray"}-600`,children:((me=s.reservations[0])==null?void 0:me.status)||"N/A"})})]},a)})})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(h-1)*b+1," to"," ",Math.min(h*b,f.allItems.length)," of"," ",f.allItems.length," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>L(h-1),disabled:h===1,children:[e.jsx(us,{className:"h-4 w-4"}),"Previous"]}),Array.from({length:f.totalPages},(s,a)=>{const r=a+1;return r>2&&r<h-1||r<f.totalPages-1&&r>h+1?e.jsx("span",{className:"text-muted-foreground",children:"..."},`ellipsis-${r}`):r===1||r===f.totalPages||Math.abs(h-r)<=1?e.jsx(m,{variant:h===r?"default":"outline",size:"sm",onClick:()=>L(r),children:r},r):null}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>L(h+1),disabled:h===f.totalPages,children:["Next",e.jsx(hs,{className:"h-4 w-4"})]})]})]}),t&&e.jsx(q,{open:X,onOpenChange:w,children:e.jsxs(G,{className:"bg-transparent p-0 max-w-4xl border-none flex flex-row gap-3",showCloseButton:!1,children:[e.jsxs("div",{className:"w-3/6 flex flex-col gap-3",children:[e.jsx(V,{className:"flex-1 flex flex-col",children:e.jsxs(J,{className:"p-4 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center space-x-3 py-3",children:[e.jsx("img",{src:pe,alt:"",width:32,height:32,className:"rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.guestName}),e.jsx("div",{className:"text-sm text-gray-500",children:t.guestEmail})]})]}),e.jsx($,{}),e.jsx("div",{className:"flex-grow",children:t.reservationType==="both"?e.jsxs(e.Fragment,{children:[e.jsxs("h4",{className:"font-semibold my-2",children:["Room Reservations (",t.reservationRoomID.length,"):"]}),e.jsx(x,{className:"max-h-[200px] overflow-y-auto w-[95%] p-2",children:t.reservations.filter(s=>s.reservation&&s.reservation.includes("Room")).map((s,a)=>e.jsx("div",{className:"mb-2 p-2 bg-gray-50 rounded",children:e.jsx("p",{className:"font-medium",children:s.reservation})},a))}),e.jsxs("h4",{className:"font-semibold my-2",children:["Venue Reservations (",t.reservationVenueID.length,"):"]}),e.jsx(x,{className:"max-h-[200px] overflow-y-auto w-[95%] p-2",children:t.reservations.filter(s=>s.reservation&&!s.reservation.includes("Room")).map((s,a)=>e.jsx("div",{className:"mb-2 p-2 bg-gray-50 rounded",children:e.jsx("p",{className:"font-medium",children:s.reservation})},a))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h4",{className:"font-semibold my-2",children:[t.reservationType," Reservations (",t.reservations.length,"):"]}),e.jsx(x,{className:"max-h-[400px] overflow-y-auto w-[95%] p-2",children:t.reservations.map((s,a)=>e.jsx("div",{className:"mb-2 p-2 bg-gray-50 rounded",children:e.jsx("p",{className:"font-medium",children:s.reservation})},a))})]})}),e.jsx($,{className:"my-2"}),e.jsxs("div",{className:"mt-auto text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Check In:"}),e.jsx("p",{children:new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0}).format(new Date(t.reservations[0].check_in_date))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Check Out:"}),e.jsx("p",{children:new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0}).format(new Date(t.reservations[0].check_out_date))})]})]})]})}),e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(ge,{htmlFor:"status",children:"Status"}),e.jsxs("div",{className:"flex-1 flex-row flex gap-3",children:[e.jsxs(ts,{value:((ne=t.reservations[0])==null?void 0:ne.status)||"default",onValueChange:Le,children:[e.jsx(as,{id:"status",className:j(((ie=t.reservations[0])==null?void 0:ie.status)||"default"),disabled:((oe=t.reservations[0])==null?void 0:oe.status)==="done"?!0:A!=="Administrator",children:e.jsx(rs,{placeholder:((le=t.reservations[0])==null?void 0:le.status)||"Please select"})}),((ce=t.reservations[0])==null?void 0:ce.status)==="done"?e.jsx(je,{children:["done"].map(s=>e.jsx(ye,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))}):e.jsx(je,{children:["ready","waiting","onUse","cancelled","onCleaning"].map(s=>e.jsx(ye,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),A==="Administrator"&&e.jsx(m,{variant:"outline",onClick:()=>Ge(t.reservationType),disabled:((de=t.reservations[0])==null?void 0:de.status)==="done",children:"Save Changes"})]})]})})]}),e.jsxs("div",{className:"w-2/6 flex flex-col gap-3",children:[e.jsxs(V,{className:"w-full bg-yellow-50 border-yellow-200 shadow-md relative",children:[e.jsx("div",{className:"absolute -top-3 -right-3 text-red-500 transform rotate-12",children:e.jsx(vs,{className:"w-6 h-6"})}),e.jsxs(J,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(ge,{htmlFor:"notes",className:"text-lg font-semibold",children:"Additional Notes"}),e.jsx(m,{variant:"outline",size:"sm",onClick:qe,className:"bg-white",children:e.jsx(ms,{className:"h-4 w-4"})})]}),e.jsx(Xe,{id:"notes",placeholder:"Type your notes here...",className:"w-full h-28 bg-yellow-50 border-yellow-200 focus:border-yellow-300 focus:ring-yellow-200",value:R,onChange:Je})]})]}),e.jsx(x,{className:"h-[calc(2/4vh-8rem)] w-full",children:e.jsx(V,{className:"bg-white text-gray-800 rounded-xl shadow-lg",children:e.jsx(J,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Partial Receipt"}),e.jsx("p",{className:"text-sm text-gray-500",children:t.guestType}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Date:"," ",new Date(t.receiptDate).toLocaleDateString()]})]}),e.jsx($,{}),e.jsxs(x,{className:"h-[calc(3/4vh-8rem)] w-full",children:[(t.reservationType==="room"||t.reservationType==="both")&&e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("h4",{className:"font-semibold",children:"Room Charges:"}),Object.entries(t.reservations.reduce((s,a)=>{if(a.room_type){const r=a.room_type,n=gs(a.check_in_date,a.check_out_date);s[r]||(s[r]={count:0,nights:n,total:0}),s[r].count+=1}return s},{})).map(([s,a])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s," (",a.count,") x ",a.nights," ","nights"]}),e.jsx("span",{children:y(a.count*a.nights*De[s])})]},s))]}),(t.reservationType==="venue"||t.reservationType==="both")&&e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("h4",{className:"font-semibold",children:"Venue Charges:"}),Object.entries(t.reservations.reduce((s,a)=>{if(!a.reservation.includes("Room")){const r=a.reservation,n=we[r]||0;s[r]||(s[r]={count:0,total:0}),s[r].count+=1,s[r].total+=n}return s},{})).map(([s,a])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s}),e.jsx("span",{children:y(a.total)})]},s))]})]}),e.jsx($,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs(x,{className:"h-[20%]",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:y(t.receiptSubTotal)})]}),t&&t.receiptAddFees&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Additional Fees:"}),e.jsx("span",{className:"text-green-600",children:y(g(0,t.receiptAddFees))})]}),t.receiptDiscounts.map((s,a)=>e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsxs("span",{children:[s.discount_name,":"]}),e.jsxs("span",{children:["-",y(t.receiptSubTotal*s.discount_percentage/100)]})]},a))]}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:y(Ae)})]})]})]})})})})]}),e.jsx("div",{className:"relative bottom-0",children:e.jsxs("div",{className:"flex flex-col h-full items-center gap-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:ze,className:"bg-white",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx("div",{className:"absolute left-full ml-2 bottom-0.5 transform opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gray-700 text-white text-xs p-2 rounded-md whitespace-nowrap",children:"Close"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:Ve,className:"bg-white",children:e.jsx(xs,{className:"h-4 w-4"})}),e.jsx("div",{className:"absolute left-full ml-2 bottom-0.5 transform opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gray-700 text-white text-xs p-2 rounded-md whitespace-nowrap",children:"Generate PDF"})]}),t.reservations[0].status!="done"&&t.reservations[0].status!="cancelled"&&e.jsxs("div",{className:"relative group ",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:Ie,className:"bg-white flex items-center justify-center",children:e.jsx(fs,{className:"h-4 w-4"})}),e.jsx("div",{className:"absolute left-full ml-3 bottom-1/2 transform translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gray-800 text-white text-xs px-3 py-1 rounded-md shadow-lg whitespace-nowrap",children:"Additional Fees"}),e.jsx(q,{open:ke,onOpenChange:ae,children:e.jsxs(G,{className:"2xl:left-[81.5%] xl:left-[81.5%] 2xl:top-[55%] xl:top-[56%] w-[300px] h-auto z-50",children:[e.jsxs(fe,{children:[e.jsx(ve,{children:"Additional Fees"}),e.jsxs(es,{className:"py-5",children:["Fee Breakdown (Total:"," ",y(g(0,t.receiptAddFees)),")"]})]}),e.jsxs(x,{className:"h-[100px] overflow-hidden",children:[e.jsx(x,{className:"h-full",children:e.jsx("ul",{className:"list-disc list-inside",children:t.receiptAddFees.map((s,a)=>e.jsxs("li",{className:"flex items-center justify-between poppins-semibold",children:[s.additional_fee_name,": ₱",s.additional_fee_amount,e.jsx("button",{onClick:()=>Oe(s.additional_fee_id),className:" text-red-500 p-1 mr-2  rounded-full hover:border-black bg-white",children:e.jsx(be,{className:"w-3 h-3 text-black"})})]},s.additional_fee_id))})}),e.jsx(x,{orientation:"vertical",className:"w-2 bg-gray-300 rounded-full"}),e.jsx(x,{})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"text",value:E,onChange:s=>se(s.target.value),placeholder:"Enter fee description",className:"border px-2 py-1 rounded-md flex-grow bg-white text-black"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:O,onChange:s=>te(s.target.value),placeholder:"Enter fee amount",className:"border px-2 py-1 rounded-md flex-grow bg-white text-black pl-7"}),e.jsx("span",{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-black",children:"₱"})," "]}),e.jsxs(m,{onClick:Ee,className:"bg-blue-500 text-white mt-2",children:[e.jsx(ps,{className:"h-4 w-4 mr-2"}),"Add Fee"]})]})]})})]}),A==="Administrator"&&e.jsxs("div",{className:"absolute group bottom-0",children:[e.jsx(m,{variant:"destructive",size:"sm",onClick:()=>Be(t),className:"flex items-center justify-center",children:e.jsx(We,{className:"h-4 w-4"})}),e.jsx("div",{className:"absolute left-full ml-2 bottom-1/2 transform translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gray-700 text-white text-xs px-2 py-1 rounded-md whitespace-nowrap",children:"Delete Guest"})]})]})})]})}),e.jsx(q,{open:Ne,onOpenChange:F,children:e.jsxs(G,{children:[e.jsx(fe,{children:e.jsx(ve,{children:"Confirm Deletion"})}),e.jsxs("p",{children:["Are you sure you want to delete the reservation for"," ",S==null?void 0:S.guestName,"?"]}),e.jsxs(ss,{children:[e.jsx(m,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:()=>He(t.reservationType),children:"Delete"})]})]})}),e.jsx(ds,{})]})}export{Us as R};
